{#  -*- coding: utf-8 -*- #}
{% import 'index_helper.tmpl' as helper with context %}
{% import 'math_helper.tmpl' as math with context %}
{% import 'comments_helper.tmpl' as comments with context %}
{% extends 'base.tmpl' %}

{% macro html_pager() %}
    {% if prevlink or nextlink %}
        <nav class="pagination">
            {% if nextlink %}
                <a class="pagination-item older" href="{{ nextlink }}">К старым</a>
            {% else %}
                <span class="pagination-item newer">К старым</span>
            {% endif %}
            {% if prevlink %}
                <a class="pagination-item newer" href="{{ prevlink }}" rel="prev">К новым</a>
            {% else %}
                <span class="pagination-item newer">К новым</span>
            {% endif %}
        </nav>
    {% endif %}
{% endmacro %}

{% block extra_head %}
    {{ super() }}
    {% if posts and (permalink == '/' or permalink == '/' + index_file) %}
        <link rel="prefetch" href="{{ posts[0].permalink() }}" type="text/html">
    {% endif %}
    {{ math.math_styles_ifposts(posts) }}

    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/favicon144.png">
    <link rel="shortcut icon" href="/public/favicon32.png">
{% endblock %}

{% block content %}
{% block content_header %}{% endblock %}
{% if 'main_index' in pagekind %}
    {{ front_index_header }}
{% endif %}
<div class="post">
{% for post in posts %}
    <article class="post h-entry post-{{ post.meta('type') }}">
    <header>
        <h1 class="post-title p-name"><a href="{{ post.permalink() }}" class="u-url">{{ post.title()|e }}</a></h1>
        <a href="{{ post.permalink() }}" class="post-lead">{{ post.description()|e }}</a>
        <div class="metadata">
            <span class="post-date dateline">
                <time class="published dt-published"
                      datetime="{{ post.formatted_date('webiso') }}"
                      title="{{ post.formatted_date(date_format)|e }}">
                    {{ post.formatted_date(date_format)|e }}
                </time>
            </span>
        </div>
    </header>
    {% if index_teasers %}
    <div class="p-summary entry-summary">
    {{ post.text(teaser_only=True) }}
    {% else %}
    <div class="e-content entry-content">
    {# post.text(teaser_only=False) #}
    {% endif %}
    </div>
    </article>
{% endfor %}
</div>
{{ html_pager() }}
{{ comments.comment_link_script() }}
{{ math.math_scripts_ifposts(posts) }}
{% endblock %}
