<html>

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name='yandex-verification' content='4db6105a4cf78b07' />

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  
    <meta name="description" content="Настройка webpack для работы с react и sass — Или вебпак для начинающих хипстеров">
    <meta property="og:title" content="Настройка webpack для работы с react и sass"/>
    <meta property="og:description" content="Или вебпак для начинающих хипстеров"/>
    <meta property="og:url" content= "http://asyncee.github.io/2016/04/07/nastrojka-webpack-dlya-raboty-s-react-i-scss/" />
    <meta property="og:image" content= "http://asyncee.github.io/public/favicon192.png" />
    <meta property="og:type" content="article"/>
    <meta property="og:locale" content= "ru_RU" />
    <meta property="og:article:author" content= "Stanislav Lobanov" />
    <meta property="og:article:published_time" content= "2016-04-07 00:00:00 +0300" />
  

  <title>
    
      Настройка webpack для работы с react и sass &middot; Asyncee
    
  </title>

  <!-- CSS -->
  <link type="text/css" rel="stylesheet" href="/assets/main-b2b18d0bc5c513e7632594126d8f4e10176140104b0f66dcb6fdda33b42339ce.css">

  <!-- js -->
  <script type="text/javascript" src="/assets/main-cff441d8fcf32afbe26ec857d859a4f0372dae11ce064e64a3715eefb8f1e8bf.js"></script>

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/favicon144.png">
  <link rel="shortcut icon" href="/public/favicon32.png">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <div class="sidebar">
  <div class="container sidebar-sticky">

    <a href="/" class="sidebar-avatar">
      <div class="avatar">
        <img class="avatar__fallback" src="/public/avatar/avatar-140-blur.jpg">
        <img class="avatar__image fadein-on-load" src="/public/avatar/avatar.jpg">
      </div>
    </a>

    <div class="sidebar-about">
      <h1>
        <a href="/">
          Asyncee
        </a>
      </h1>
      <p class="lead">Lobanov Stanislav</p>
    </div>

    <nav class="sidebar-nav">

      
      
        
          
        
      
        
      
        
          
        
      
        
          
        
      
        
      
    </nav>

  </div>
</div>


    <div class="content container">
      <div class="post">
  <h1 class="post-title">Настройка webpack для работы с react и sass</h1>
  <span class="post-date">Опубликовано

7
Апреля
  
2016
</span>
  <p>В этой статье я опишу как настроить <a href="https://webpack.github.io/">webpack</a> с поддержкой замечательного фреймворка <a href="https://facebook.github.io/react/">react</a> для определения структуры интерфейса и <a href="http://sass-lang.com/">sass</a> для его стилизации.</p>

<p>На самом деле эти технологии можно использовать и без webpack, например, встраивать напрямую в код веб-страницы, но с бандлером это делать не только удобнее, но и решение получается более производительным.</p>

<p>Сразу оговорюсь, что я всё-таки больше backend developer, поэтому статья может содержать неточности, однако весь мой опыт изложенный ниже был неоднократно подтверждён на практике.</p>

<p>Итак, поехали!</p>

<h2 id="Установка">Установка</h2>

<p>Для работы конфига необходимы следующие библиотеки:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>npm install -g webpack
npm install --save-dev webpack
</code></pre>
</div>

<p>Сам <strong>webpack</strong>. Устанавливать его следует глобально — в систему и локально — в проект. Глобальная установка даст возможность использовать команду <code class="highlighter-rouge">webpack</code>, а локальная — использовать его как библиотеку.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>npm install --save-dev babel-core babel-loader babel-preset-es2015 babel-preset-react babel-preset-stage-0 babel-preset-stage-1
</code></pre>
</div>

<p>Прежде всего, <strong>babel</strong> с набором плагинов, объединённых в <em>пресеты</em>, внедряющих поддержку стандарта <a href="http://www.ecma-international.org/publications/standards/Ecma-262.htm">ES2015</a>, react−а с его <a href="https://facebook.github.io/react/docs/jsx-in-depth.html">JSX</a> и разных фич ES6/7.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>npm install --save-dev css-loader style-loader sass-loader resolve-url-loader extract-text-webpack-plugin
</code></pre>
</div>

<p>Загрузчики, реализующие поддержку файлов со стилями и плагин для сохранения извлечённых стилей в отдельный файл.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>npm install --save-dev react react-dom bootstrap-sass
</code></pre>
</div>

<p>И оставшиеся react и scss-версия bootstrap.</p>

<h2 id="Структура-проекта">Структура проекта</h2>

<p>Привожу структуру проекта, в данном случае — для простого одностраничного приложения. Структура вашего проекта может разительно отличаться, но для целей демонстрации она подходит очень хорошо.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>├── index.html
├── package.json
├── webpack.config.js
└── static
    ├── build
    │   ├── bundle.js
    │   └── styles.css
    ├── app.js
    └── main.scss
</code></pre>
</div>

<h2 id="Настройка">Настройка</h2>

<p>Сначала конфиг — потом пояснения.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">webpack</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'webpack'</span><span class="p">);</span>
<span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'path'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">ExtractTextPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'extract-text-webpack-plugin'</span><span class="p">);</span>


<span class="nx">webpackConfig</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">context</span><span class="p">:</span> <span class="nx">__dirname</span><span class="p">,</span>
    <span class="na">entry</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">bundle</span><span class="p">:</span> <span class="s1">'./static/app.js'</span><span class="p">,</span>
        <span class="na">styles</span><span class="p">:</span> <span class="s1">'./static/main.scss'</span>
    <span class="p">},</span>
    <span class="na">output</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">filename</span><span class="p">:</span> <span class="s1">'[name].js'</span><span class="p">,</span>
        <span class="na">path</span><span class="p">:</span> <span class="s1">'./static/build'</span><span class="p">,</span>
        <span class="na">library</span><span class="p">:</span> <span class="s1">'[name]'</span>
    <span class="p">},</span>
    <span class="na">resolve</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">extensions</span><span class="p">:</span> <span class="p">[</span><span class="s1">''</span><span class="p">,</span> <span class="s1">'.js'</span><span class="p">,</span> <span class="s1">'.jsx'</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="na">devtool</span><span class="p">:</span> <span class="s1">'#cheap-module-source-map'</span><span class="p">,</span>
    <span class="na">module</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">loaders</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="na">test</span><span class="p">:</span> <span class="sr">/</span><span class="se">\.</span><span class="sr">jsx</span><span class="se">?</span><span class="sr">$/</span><span class="p">,</span>
                <span class="na">exclude</span><span class="p">:</span> <span class="p">[</span><span class="sr">/node_modules/</span><span class="p">],</span>
                <span class="na">loader</span><span class="p">:</span> <span class="s2">"babel-loader"</span><span class="p">,</span>
                <span class="na">query</span><span class="p">:</span> <span class="p">{</span>
                    <span class="na">presets</span><span class="p">:</span> <span class="p">[</span><span class="s1">'es2015'</span><span class="p">,</span> <span class="s1">'react'</span><span class="p">,</span> <span class="s1">'stage-0'</span><span class="p">,</span> <span class="s1">'stage-1'</span><span class="p">]</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="na">test</span><span class="p">:</span> <span class="sr">/</span><span class="se">\.</span><span class="sr">scss$/</span><span class="p">,</span>
                <span class="na">loader</span><span class="p">:</span> <span class="nx">ExtractTextPlugin</span><span class="p">.</span><span class="nx">extract</span><span class="p">(</span><span class="s1">'style-loader'</span><span class="p">,</span> <span class="s1">'css-loader!resolve-url!sass-loader?sourceMap'</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="na">test</span><span class="p">:</span> <span class="sr">/</span><span class="se">\.</span><span class="sr">css$/</span><span class="p">,</span>
                <span class="na">loader</span><span class="p">:</span> <span class="nx">ExtractTextPlugin</span><span class="p">.</span><span class="nx">extract</span><span class="p">(</span><span class="s1">'style-loader'</span><span class="p">,</span> <span class="s1">'css-loader'</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="na">test</span><span class="p">:</span> <span class="sr">/</span><span class="se">\.</span><span class="sr">woff2</span><span class="se">?</span><span class="sr">$|</span><span class="se">\.</span><span class="sr">ttf$|</span><span class="se">\.</span><span class="sr">eot$|</span><span class="se">\.</span><span class="sr">svg$|</span><span class="se">\.</span><span class="sr">png|</span><span class="se">\.</span><span class="sr">jpe</span><span class="se">?</span><span class="sr">g|</span><span class="se">\.</span><span class="sr">gif$/</span><span class="p">,</span>
                <span class="na">loader</span><span class="p">:</span> <span class="s1">'file-loader'</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="na">plugins</span><span class="p">:</span> <span class="p">[</span>
        <span class="k">new</span> <span class="nx">ExtractTextPlugin</span><span class="p">(</span><span class="s1">'styles.css'</span><span class="p">,</span> <span class="p">{</span>
            <span class="na">allChunks</span><span class="p">:</span> <span class="kc">true</span>
        <span class="p">})</span>
    <span class="p">]</span>
<span class="p">};</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">webpackConfig</span><span class="p">;</span>
</code></pre>
</div>

<p>Исходных файлов два — <code class="highlighter-rouge">static/app.js</code> и <code class="highlighter-rouge">static/main.scss</code>. После запуска команды <code class="highlighter-rouge">webpack</code> произойдёт загрузка данных из них с помощью определённых в конфиге загрузчиков.</p>

<p>Файлы с расширениями <em>.js</em> и <em>.jsx</em> будут обработаны <strong>babel</strong>−ом:</p>

<ul>
  <li>jsx-синтаксис react−а будет преобразован в обычный яваскрипт</li>
  <li>es6/7 синтаксис будет преобразован в es5</li>
</ul>

<p>Для обработки <em>scss</em>−стилей используется набор лоадеров, в том числе <strong>sass-loader</strong>:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="p">{</span>
    <span class="nl">test</span><span class="p">:</span> <span class="sr">/</span><span class="se">\.</span><span class="sr">scss$/</span><span class="p">,</span>
    <span class="nx">loader</span><span class="err">:</span> <span class="nx">ExtractTextPlugin</span><span class="p">.</span><span class="nx">extract</span><span class="p">(</span><span class="s1">'style-loader'</span><span class="p">,</span> <span class="s1">'css-loader!resolve-url!sass-loader?sourceMap'</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
</div>

<p>Здесь мы указываем, что все <em>.scss</em> файлы будут обработаны сначала <strong>sass-loader</strong>, который на выходе сгенерирует обычный css. Затем в дело вступает <strong>resolve-url-loader</strong>, задача которого найти относительные пути к файлам в css (например, в директиве <code class="highlighter-rouge">url(../image.jpg)</code>) и преобразовать их в абсолютные (для этого обязательно нужно включить source-map в предыдущем загрузчике). Результат передаётся в <strong>css-loader</strong>, который непосредственно отвечает за поддержку css в webpack. В случае, если что-то пошло не так, использоваться будет <strong>style-loader</strong>.</p>

<p>Так, с загрузчиками понятно, а что такое <code class="highlighter-rouge">ExtractTextPlugin</code>? Ответ — это плагин, который сохраняет полученный от загрузчиков текст (исходный код) в отдельные чанки.</p>

<p>А дальше можно сохранить текст из этих чанков в отдельный файл, в данном случае <em>styles.css</em>:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="k">new</span> <span class="nx">ExtractTextPlugin</span><span class="p">(</span><span class="s1">'styles.css'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">allChunks</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">}),</span>
</code></pre>
</div>

<p>Опция <code class="highlighter-rouge">allChunks: true</code> указывает, что нужно все чанки склеить и сохранить в один файл, иначе они будут сохранены в отдельные файлы.</p>

<p>После обработки, вебпак сгенерирует выходные файлы в директории <code class="highlighter-rouge">./static/build/</code>:</p>

<div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"/static/build/styles.css"</span><span class="nt">&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"/static/build/bundle.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</code></pre>
</div>

<p>В целом данная конфигурация подходит для разработки простых одностраничных приложений. На выходе получается несколько файлов со скриптами и стилями, которые можно подключить на страницу.</p>

<p>После загрузки бандла, его исходный код будет прочитан и исполнен интерпретатором javascript. Также, благодаря опции <code class="highlighter-rouge">output.library</code> <strong>webpack</strong> экспортирует загруженный модуль в переменную с названием секции в <code class="highlighter-rouge">entry</code>, в данном случае — <code class="highlighter-rouge">bundle</code>. Это очень удобно, так как ваш модуль подключается как библиотека и становится доступен в глобальной области видимости:</p>

<div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;script&gt;</span>
<span class="c1">// sayHello — функция, определённая в файле app.js</span>
<span class="nx">bundle</span><span class="p">.</span><span class="nx">sayHello</span><span class="p">()</span>
<span class="c1">// или</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">bundle</span><span class="p">.</span><span class="nx">sayHello</span><span class="p">();</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre>
</div>

<p>Стоит учесть, что webpack может генерировать бандлы, которые при загрузке автоматически подключат нужные стили на страницу, это реализуется с помощью <strong>style-loader</strong> и особенно удобно при разработке приложений с большим числом страниц или react-компонентов.</p>

<p>На этом всё. Удачного кодинга!</p>

</div>

<div id="disqus_thread"></div>
<script>

var disqus_config = function () {
this.page.url = "http://asyncee.github.io/2016/04/07/nastrojka-webpack-dlya-raboty-s-react-i-scss/";  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = "/2016/04/07/nastrojka-webpack-dlya-raboty-s-react-i-scss/"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = '//asyncee-github-io.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


    </div>

        <!-- Yandex.Metrika counter -->
    <script type="text/javascript">
        (function (d, w, c) {
            (w[c] = w[c] || []).push(function() {
                try {
                    w.yaCounter36001570 = new Ya.Metrika({
                        id:36001570,
                        clickmap:true,
                        trackLinks:true,
                        accurateTrackBounce:true,
                        webvisor:true
                    });
                } catch(e) { }
            });

            var n = d.getElementsByTagName("script")[0],
                s = d.createElement("script"),
                f = function () { n.parentNode.insertBefore(s, n); };
            s.type = "text/javascript";
            s.async = true;
            s.src = "https://mc.yandex.ru/metrika/watch.js";

            if (w.opera == "[object Opera]") {
                d.addEventListener("DOMContentLoaded", f, false);
            } else { f(); }
        })(document, window, "yandex_metrika_callbacks");
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/36001570" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->


    <!-- JS -->
    <script async src="/public/js/medium-zoom.min.js" onload="initMediumZoom()"></script>
    <link href="https://fonts.googleapis.com/css?family=Abril+Fatface|Lora:400,400i,700|Roboto+Mono&amp;subset=cyrillic" rel="stylesheet">
  </body>
</html>
