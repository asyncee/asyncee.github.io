<html>

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name='yandex-verification' content='4db6105a4cf78b07' />

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  
    <meta name="description" content="Вспомогательные объекты для верстальщика в Django — Или как избавиться от html-разметки в статичных блоках">
    <meta property="og:title" content="Вспомогательные объекты для верстальщика в Django"/>
    <meta property="og:description" content="Или как избавиться от html-разметки в статичных блоках"/>
    <meta property="og:url" content= "http://asyncee.github.io/2016/03/11/vspomogatelnye-obuekty-dlya-verstalshika-v-django/" />
    <meta property="og:image" content= "http://asyncee.github.io/public/favicon192.png" />
    <meta property="og:type" content="article"/>
    <meta property="og:locale" content= "ru_RU" />
    <meta property="og:article:author" content= "Stanislav Lobanov" />
    <meta property="og:article:published_time" content= "2016-03-11 00:00:00 +0300" />
  

  <title>
    
      Вспомогательные объекты для верстальщика в Django &middot; Asyncee
    
  </title>

  <!-- CSS -->
  <link type="text/css" rel="stylesheet" href="/assets/main-4433e655571e47206a4c519eaec29e54d31f24c8431c0d8759bec19b7beaf610.css">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/favicon144.png">
  <link rel="shortcut icon" href="/public/favicon32.png">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <div class="sidebar">
  <div class="container sidebar-sticky">

    <a href="/" class="sidebar-avatar">
      <img class="sidebar-avatar__image" src="/public/avatar.jpg">
    </a>

    <div class="sidebar-about">
      <h1>
        <a href="/">
          Asyncee
        </a>
      </h1>
      <p class="lead">Lobanov Stanislav</p>
    </div>

    <nav class="sidebar-nav">

      
      
        
          
        
      
        
      
        
          
        
      
        
          
        
      
        
      
    </nav>

  </div>
</div>


    <div class="content container">
      <div class="post">
  <h1 class="post-title">Вспомогательные объекты для верстальщика в Django</h1>
  <span class="post-date">Опубликовано

11
Марта
  
2016
</span>
  <p>Сегодня возникла задача — реализовать возможность добавления выпадающих меню в произвольное место на сайте.</p>

<p>Структура веб-сайта может содержать разнообразные элементы, которые могут отображаться динамически, получая данные как из базы, так и вручную, посредством написания html/css кода в нужном месте. Например, это удобно в случае, когда в каком-то месте сайта должен стоять один или несколько произвольных блоков, параметры которых определяются из вне системы (например, заказчиком). Примерами могут служить стилизованная ссылка, ведущая на сайт клиента, текст или элементы в футере, счётчики.</p>

<p>Такие задачи нам помогает решать приложение  <a href="https://github.com/asyncee/django-cmstemplates/">django-cmstemplates</a>, которое позволяет динамически создавать нужные блоки в определённых частях сайта, а самое главное - их можно редактировать прямо из админки, используя синтаксис шаблонов Django.</p>

<p>Так вот, возвращаясь к задаче — необходимо реализовать меню с выпадающим списком. Проблему эту можно решить десятком способов, но мне хотелось избавиться от дублирования одной и той же разметки в разных блоках.</p>

<p>Для этого я написал вот такой вспомогательный класс, описывающий выпадающее меню:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">uuid</span>

<span class="kn">from</span> <span class="nn">django.template.loader</span> <span class="kn">import</span> <span class="n">render_to_string</span>


<span class="k">class</span> <span class="nc">DropdownMenu</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">links</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="nb">id</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s">'name'</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s">'url'</span><span class="p">:</span> <span class="n">url</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">render_to_string</span><span class="p">(</span><span class="s">'blocks/dropdown_menu.html'</span><span class="p">,</span> <span class="p">{</span><span class="s">'menu'</span><span class="p">:</span> <span class="bp">self</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>
</code></pre>
</div>

<p>Я думаю, что код здесь максимально понятный, и говорит сам за себя даже без докстрингов. <code class="highlighter-rouge">DropdownMenu</code> — всего лишь вспомогательный класс, призванный хранить состояние описываемой сущности.</p>

<p>Объекты класса рендерят себя, используя такой шаблон:</p>

<div class="language-django highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"drop-down-menu"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">""</span> <span class="na">class=</span><span class="s">"drop-down-menu__link"</span><span class="nt">&gt;</span>
         <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"caret"</span><span class="nt">&gt;&lt;/span&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"drop-down-menu__items"</span><span class="nt">&gt;</span>
        
    <span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre>
</div>

<p>Выглядит это следующим образом:</p>

<p><img src="/public/posts/dropdown_menu.png" alt="выпадающее меню" /></p>

<p>Создание и изменение меню реализовано с помощью шаблонных тегов:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># coding: utf-8</span>

<span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">template</span>

<span class="kn">from</span> <span class="nn">core.templatetags.dropdown</span> <span class="kn">import</span> <span class="n">DropdownMenu</span>

<span class="n">register</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">Library</span><span class="p">()</span>


<span class="nd">@register.simple_tag</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">dropdown_menu</span><span class="p">(</span><span class="n">title</span><span class="p">):</span>
    <span class="n">menu</span> <span class="o">=</span> <span class="n">DropdownMenu</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">menu</span>


<span class="nd">@register.simple_tag</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">add_link</span><span class="p">(</span><span class="n">menu</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
    <span class="n">menu</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
    <span class="k">return</span> <span class="s">''</span>
</code></pre>
</div>

<p>Для вывода меню нужно добавить в шаблон следующее:</p>

<div class="language-django highlighter-rouge"><pre class="highlight"><code><span class="cp">{%</span> <span class="nv">dropdown_menu</span> <span class="s1">'Поисковая система'</span> <span class="k">as</span> <span class="nv">menu</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="nv">add_link</span> <span class="nv">menu</span> <span class="s1">'Yandex'</span> <span class="s1">'http://yandex.ru'</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="nv">add_link</span> <span class="nv">menu</span> <span class="s1">'Google'</span> <span class="s1">'http://google.com'</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="nv">add_link</span> <span class="nv">menu</span> <span class="s1">'Bing'</span> <span class="s1">'http://bing.com'</span> <span class="cp">%}</span>

<span class="c">{# Вот так меню рендерится в html #}</span>
<span class="cp">{{</span> <span class="nv">menu</span> <span class="cp">}}</span>
</code></pre>
</div>

<p>В целом получилось достаточно просто, а главное теперь удобно работать с меню из шаблонов, и автоматически мы следуем принципу DRY - Dont Repeat Yourself.</p>

<p>Данный пример лишь иллюстрирует возможности подхода и не ограничивается только на создании меню. Такой подход можно использовать для любых других элементов интерфейса.
Хотя приведённый пример на сто процентов решает нашу задачу, реализацию можно улучшить, например, написать шаблонный тег, реализующий более удобный синтаксис:</p>

<div class="language-django highlighter-rouge"><pre class="highlight"><code><span class="cp">{%</span> <span class="nv">menu</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="nv">link</span> <span class="s1">'Yandex'</span> <span class="s1">'http://yandex.ru'</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="nv">link</span> <span class="nv">google_variable</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="nv">endmenu</span>
</code></pre>
</div>

<p>На этом всё. Удачи!</p>

</div>

<div id="disqus_thread"></div>
<script>

var disqus_config = function () {
this.page.url = "http://asyncee.github.io/2016/03/11/vspomogatelnye-obuekty-dlya-verstalshika-v-django/";  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = "/2016/03/11/vspomogatelnye-obuekty-dlya-verstalshika-v-django/"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = '//asyncee-github-io.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


    </div>

        <!-- Yandex.Metrika counter -->
    <script type="text/javascript">
        (function (d, w, c) {
            (w[c] = w[c] || []).push(function() {
                try {
                    w.yaCounter36001570 = new Ya.Metrika({
                        id:36001570,
                        clickmap:true,
                        trackLinks:true,
                        accurateTrackBounce:true,
                        webvisor:true
                    });
                } catch(e) { }
            });

            var n = d.getElementsByTagName("script")[0],
                s = d.createElement("script"),
                f = function () { n.parentNode.insertBefore(s, n); };
            s.type = "text/javascript";
            s.async = true;
            s.src = "https://mc.yandex.ru/metrika/watch.js";

            if (w.opera == "[object Opera]") {
                d.addEventListener("DOMContentLoaded", f, false);
            } else { f(); }
        })(document, window, "yandex_metrika_callbacks");
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/36001570" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->


    <!-- JS -->
    <script>
      function initMediumZoom() {
        mediumZoom('.content img');
      }
    </script>
    <script async src="/public/js/medium-zoom.min.js" onload="initMediumZoom()"></script>
    <link href="https://fonts.googleapis.com/css?family=Abril+Fatface|Lora:400,400i,700|Roboto+Mono&amp;subset=cyrillic" rel="stylesheet">
  </body>
</html>
